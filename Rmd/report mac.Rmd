---
output:
  word_document:
    reference_docx: ../report_template.dotx
mathjax: TRUE
---


```{r, knitr, echo=FALSE, fig.asp=1.15, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}
library(knitr)

knitr::opts_chunk$set(
               cache     =TRUE, 
               comment   ="", 
               warning   =FALSE, 
               message   =FALSE, 
               error     =FALSE, 
               echo      =FALSE, 
               eval      =TRUE,
               crop      =TRUE,
               cache.path="../cache/figs/cond/",
               fig.path  ="../tex/figs",
               fig.width =10,
               fig.height=8,
               dev       ="png")

rm(list=ls())

iFig=0
iTab=0

library(FLCore)    # install.packages("FLCore", repos="http://flr-project.org/R")
library(FLBRP)     # install.packages("FLBRP", repos="http://flr-project.org/R")
library(FLasher)   # install.packages("FLasher", repos="http://flr-project.org/R")
library(FLAssess)  # install.packages("FLAssess", repos="http://flr-project.org/R")
library(FLife)     # install.packages("FLife", repos="http://flr-project.org/R")
library(ggplotFL)

library(popbio)

library(GGally)
library(ggpubr)

library(rjson) # install.packages("rjson"); used for dropbox function
library(RJSONIO)

library(plyr)
library(dplyr)
library(reshape)

library(readxl)
  
library(mgcv)
library(mgcViz)

library(tidyverse)

theme_set(theme_bw(16))

library(captioner)     # captions
tab_nums <- captioner::captioner(prefix = "Table", levels=1, type=c("n"), infix=".")
fig_nums <- captioner::captioner(prefix = "Figure", levels=1, type=c("n"), infix=".")

source("../R/dd.R")
source("../R/pm.R")
```


```{r}
source("../R/get_dropbox.r")

dropboxdir<-try(file.path(get_dropbox(), "pelagics"))

if ("try-error"%in%is(dropboxdir))
  dropboxdir="~/Dropbox/pelagics"


mystk     <- "mac"; mystkname <- "Northeast Atlantic mackerel"; mylatin <- "Scombrus scomber"
# mystk     <- "whb"; mystkname <- "Blue whiting";                mylatin <- "Micromesistius poutassou" 
maxyear <- 2050

load(file=file.path(dropboxdir,paste0("data/om/",mystk,"matPar.RData")))
load(file=file.path(dropboxdir, "data", "inputs", "myparams.RData"))
 
figuresdir <- file.path(dropboxdir, "results", mystk, "figures")
tablesdir  <- file.path(dropboxdir, "results", mystk, "tables")


```

<!-- =============================================================================================================== -->
<!-- ## Mackerel report                                                                                              -->
<!-- =============================================================================================================== -->


**Evaluating impacts of Density Dependent processes on `r mystkname` via MSE simulations**


**L. Kell, M.A. Pastoors**

`r format(Sys.time(), '%d/%m/%Y')`

Commissioned by: University of Copenhagen (Henrik Sparholt)

**Executive summary**

[summary here]



<!-- =============================================================================================================== -->
<!-- Section 1: introduction                                                                                         -->
<!-- =============================================================================================================== -->

```{r}

# captioner::bump(fig_nums, level=1)
# fig_nums(name    = "section1_fig", caption = "section1_fig", level = 1, display = FALSE)
# tab_nums(name    = "section1_tab", caption = "section1_tab", level = 1, display = FALSE)

```

# Introduction

The purpose of this work is to support the project “Fmsy-project for six high profile fish stocks”. The project focuses on the current management approach for fish stocks based on single-species Fmsy Values where the only density-dependent process that is included is recruitment. The project includes three other density-dependent population dynamics: growth (weight at age), sexual maturity and natural mortality.  

This report deals with the evaluation of density dependent processes for `r mystkname` using Management Strategy Evaluation (MSE). Steps in the analysis:

1. Conditioning and summaries based on the 2022 ICES assessment (section 2)
2. Estimating Density Dependent effects based on equilibrium analyses and explore DD before setting up the OMs (section 3)
3. Setting up the Operating Models (OM) (section 4)
4. Running MSE's (section 5)

Four alternatives OMs have been included in the analyses: 

1. No density dependent processes
2. DD in growth
3. DD in growth and maturity
4. DD in growth, maturity and natural mortality

All MSE's have been developed within the FLR framework (https://flr-project.org/) and all the code is stored on github (https://github.com/martinpastoors/ddmse). 

All data and results are available on DropBox (https://www.dropbox.com/sh/k87x074xqw7sgae/AAAmF980iR2n24wTkqhOhnpfa?dl=0)

<!-- =============================================================================================================== -->
<!-- Section 2: conditioning and summaries of ICES assessment                                                        -->
<!-- =============================================================================================================== -->


# Conditioning and summaries based on the 2022 ICES assessment

The 2022 ICES update assessment of mackerel (ICES 2022) has been carried out by fitting the state-space assessment model SAM (Nielsen and Berg, 2014). The update is based on the benchmark protocol as established in 2019 (ICES 2019). The assessment model is fit to catch-at-age data for ages 0 to 12 (plus group) for the period 1980 to 2021 (with a strong down-weighting of the catches for the period 1980-1999) and three surveys: 1) SSB estimates from the triennial Mackerel Egg survey (every three years in the period 1992-2022), 2) a recruitment index from the western Europe bottom trawl IBTS Q1 and Q4 surveys (1998-2020, could not be updated for 2021) and 3) the abundance estimates for ages 3 to 11 from the IESSNS survey (2010, 2012-2022). The model also incorporates tagging-recapture data from the Norwegian tagging program (for fish recaptured between 1980 and 2005 for the steel tags time series, and fish recaptured between 2014 and 2021 (age 5 and older at release) for the radio frequency tags time series). Fishing mortality-at-age and recruitment are modelled as random walks, and there is a process error term on abundances at ages 1-11 (ICES 2022).  


```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "assessment", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Summary of ICES assessment (ICES 2022)"))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "assessment_summary.jpg", sep="_")))

```

_`r fig_nums("assessment")`_

To be able to handle the outputs of the SAM assessment in the FLR framework, a conversion from the SAM object to a FLStock object has been applied. Trends in weight at age (mass at age), maturity at age and natural mortality are shown below, with a specific focus on detecting potential density-dependent relationships. 

**Weight at age**

As noted in the ICES assessment report, "there is a trend towards lighter weight-at-age for the most age classes (except 0 to 2 years old) starting around 2005, continuing until 2013 (Figure 8.5.2.1). This decrease in the catch mean weight-at-age seems to have stopped since 2013 and values for the last seven years do not show any particular trend for the older ages (age 6 and older) and are slightly increasing for younger ages (ages 1 to 5)." (ICES 2022)

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_waa", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Weight at age by year and cohort"))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "waa.jpg", sep="_")))

```

_`r fig_nums("cond_waa")`_

\newpage

**Maturity at age**

The maturity ogive for mackerel is calculated as the average of the maturity ogives of the three spawning components of mackerel (Western component, Southern component, North Sea component) weighted by the relative size of each component as estimated during the triennial egg survey. The maturity ogives for the North Sea and Southern components are fixed over time. For the Western component, the ogive is updated every year, using maturity data from commercial catch samples from Germany, Ireland, the Netherlands and the UK collected during the first and second quarters. Most of the variability in maturity is observed for age 2 and to a lesser extent for age 3. 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_mat", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Maturity at age by year and cohort"))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "mat.jpg", sep="_")))

```

_`r fig_nums("cond_mat")`_

\newpage

**Natural mortality at age (fixed)**

Natural mortality is assumed to be 0.15 for all age groups and constant over time (ICES 2022).This value was calculated based on estimates of total mortality derived from tagging data combined with catch data (Hamre, 1980). 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_natmor", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Natural mortality at age by year and cohort (all ages and years the same M)"))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "m.jpg", sep="_")))

```

_`r fig_nums("cond_natmor")`_

\newpage


**Density dependence in Weight at age vs. Total biomass**

The distribution of weight at age over the whole time series is shown in the plot below (left part). The linear regression of the weight residual by age (weight/mean(weight)) is shown in the right hand part of the plot below. From ages 4-12 there are clear indications of a downward relationship between total biomass and weight at age. For the younger ages, such a relationship is not clearly apparent. 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_ddwaa", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Density dependence and weight at age."))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "dd_waa.jpg", sep="_")))

```

_`r fig_nums("cond_ddwaa")`_

\newpage

**GAMM model of weight at age vs. Total biomass**

A Generalized Additive Mixed Model was developed to assessment the relationship between age, weight at age residual and a Thin place regression spline based on the total biomass residual.     

mgcViz::gammV(log(data) ~ age + s(tb/mean(tb), bs="tp"), data=wt2)

Results for the weight at age residual are shown below with summaries of the model fits and model coefficients in the tables below that. Overall, this suggests that there is a negative relationship between total biomass and weight at age residual, i.e. with higher biomass, weight at age tends to be lower. 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_gammwaa", level = 1, display = FALSE,
  caption = paste0(mystkname, ". GAMM analysis of density dependence and weight at age."))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "gamm.jpg", sep="_")))

```

_`r fig_nums("cond_gammwaa")`_

\newpage

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

tab_nums(
  name    = "cond_gammsummary", level = 1, display = FALSE,
  caption = paste0(mystkname, ". GAMM summary of density dependence and weight at age."))

cat(readLines(file.path(tablesdir, paste(mystk, "gamm summary.txt", sep="_"))), sep = '\n')

```

_`r tab_nums("cond_gammsummary")`_

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

tab_nums(
  name    = "cond_gammcoefficients", level = 1, display = FALSE,
  caption = paste0(mystkname, ". GAMM coefficients of density dependence and weight at age."))

cat(readLines(file.path(tablesdir, paste(mystk, "gamm coefficients.txt", sep="_"))), sep = '\n')

```

_`r tab_nums("cond_gammcoefficients")`_

\newpage

**Comparing observations and GAMM model estimates of density dependence in weight at age**

As a final check on the GAMM analysis, we plotted the predictions from the GAMM model over the observed weight at age, demonstrating that the model is capturing the overall trend in the data.  

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_lmwaa", level = 1, display = FALSE,
  caption = paste0(mystkname, ". LM analysis of density dependence and weight at age."))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "lm_waa.jpg", sep="_")))

```

_`r fig_nums("cond_lmwaa")`_

\newpage

**Analysis of density dependence in maturity at age**

The distribution of maturity at age over the whole time series is shown in the plot below (left part). Only ages 1-3 have proportions mature that are between 0 and 1. The linear regression of the maturity residual by age (maturity/mean(maturity)) is shown in the right hand part of the plot below. For ages 2 and 3 there are weak indications of a downward relationship between total biomass and maturity.  


```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_ddmat", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Analysis of density dependence and maturity at age."))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "dd_mat.jpg", sep="_")))

```

_`r fig_nums("cond_ddmat")`_

\newpage

**Estimated maturity at weight**

Maturity at weight was estimated using the following model: 

$f(wt) = \frac{1}{1+e^{-k(wt-W_{50})}}$

With estimated parameters: k=`r format(matPar$par[1], digits=3, nsmall=2)` $W_{50}$=`r format(matPar$par[2], digits=4)`. In the graph below, the blue line represents a simple LOESS smoother while the red line represents the model mentioned above. 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "cond_matogive", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Estimated maturity ogive at weight"))

knitr::include_graphics(path=file.path(figuresdir, paste(mystk, "mat_ogive.jpg", sep="_")))

```

_`r fig_nums("cond_matogive")` _

 
<!-- =============================================================================================================== -->
<!-- Section 3: Estimating Density Dependent effects based on equilibrium analyses                                   -->
<!-- =============================================================================================================== -->

# Estimating Density Dependent effects based on equilibrium analyses

In this section, density dependent effects are assessment based on theoretical relationships established in the scientific literature and data that is derived from FishBase. Life history parameters are used to develop an example of modelling density dependence for weight, maturity and natural mortality-at-age. Natural mortality parameters m1 and m2 are derived from Lorenzen (1997) where the natural mortality at weight was expressed as $M_{W} = M_{u}W^{b}$ with $M_{u}$ is equal to natural mortality at unit weight. Given that the assumed natural mortality of `r mystkname` is equal to 0.15 for all ages, and that the natural mortality at 300 gram bodyweight could be equivalent to the general natural mortality, the formula to derive $M_{u}$ has been implemented as: `r myparams[myparams$stock==mystk,"m1txt"]`

The life-history parameters for the equilibrium analyses can then be summarised as follows: 

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

tab_nums(
  name    = "dd_pars", level = 1, display = FALSE,
  caption = paste0(mystkname, ". Life-history parameters derived from FishBase"))

cat(readLines(file.path(tablesdir, paste(mystk, "par.txt", sep="_"))), sep = '\n')

```

_`r tab_nums("dd_pars")`_

The life history parameters are then used to construct a `FLBRP` object representing equilibrium values, and are then coerced into a `FLStock` object to model the time series dynamics.

## Mass-at-age [SHOULD WE CALL IT WEIGHT AT AGE, SINCE WE ARE USING Wa? ]

**DO WE STILL NEED THIS SECTION?**

Mass-at-age ($W_a$) is modelled as

$W_a = {\overline{W_a}} B^{{\beta}_a}$

Where $\overline{W_a}$ and $\beta$ are estimated from a regression of mass-at-age ($W_a$) on total biomass ($B_a$), based on empirical data. $W_a$ is constrained so sizes do not become unfeasible large or small.

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "sim_dd_mass", level = 1, display = FALSE,
  caption = "Simulation of density dependence in mass-at-age for different levels of biomass relative to Bmsy. Each line represents the equilibrium values by age for different levels of fishing mortality (from F=0 to Fcrash). The red line corresponds to Fmsy")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_sim_dd_mass.jpg")))

```

_`r fig_nums("sim_dd_mass")`_

## Maturity-at-weight

**DO WE STILL NEED THIS SECTION?**

Maturity is modelled as a logistic function of mass-at-age i.e.

$O(W_a) = 1/(1+e^{k(W_a-W_{50})})$

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "sim_dd_mat", level = 1, display = FALSE,
  caption = "Simulation of density dependence in maturity-at-age for different levels of biomass relative to Bmsy. Each line represents the equilibrium values by age for different levels of fishing mortality (from F=0 to Fcrash). The red line corresponds to Fmsy")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_sim_dd_maturity.jpg")))

```

_`r fig_nums("sim_dd_mat")`_


## Natural mortality

**DO WE STILL NEED THIS SECTION?**

Is assumed to vary at unit length ($L_1$) e.g.

$ln(M_1) =\alpha + \beta ln(L_{\infty}) + \gamma ln(k)$

where $\alpha=0.65$, $\beta=0.91$, $\gamma=0.87$

Length-at-age ($L_a$) can be obtained from the length-weight relationship

$L_a=(W/a)^{1/b}$

giving

$ln(M_1) =(W/a)^{1/b}(\alpha + \beta ln(L_{\infty}) + \gamma ln(k))$

For DD there is a relationship between Mass at age $M_a$ and total biomass ($B$)

Mackerel:

$M = 0.0232B + 0.0524$  **HOW DOES THIS RELATE TO THE VALUES USED IN THE REPORT?**

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "sim_dd_m", level = 1, display = FALSE,
  caption = "Simulation of density dependence in M-at-age for different levels of biomass relative to Bmsy")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_sim_dd_m.jpg")))

```

_`r fig_nums("sim_dd_m")`_

\newpage

Comparison of equilibrium yield plots for simulation with and without density-dependent processes

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "sim_yield", level = 1, display = FALSE,
  caption = "Simulation of density dependence in M-at-age for different levels of biomass relative to Bmsy")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_eq_yield.jpg")))

```

_`r fig_nums("sim_dd_m")`_



<!-- =============================================================================================================== -->
<!-- Section 4: Setting up the Operating Models (OM)                                                                 -->
<!-- =============================================================================================================== -->

# Setting up the Operating Models (OM)

**Stock assessments**

The initial stock assessments was carried out with SAM and a fixed M by years and ages. Because SAM allows for deviation from the catch equation, there can be strong discrepancies between the estimated recruitment by year and the materialized recruitment as evident from the appearance in the catches. This could lead to spurious recruitment patterns. To circumvent that potential problem in the simulations, we estimated a VPA model based on SAM assessment, using the terminal Fs or Ns from the SAM assessment as inputs. We then ran that VPA model also with age-varying M to assessment whether we could reproduce the overall equilibrium curves for total biomass and yield.  

The VPA reconstructions of the SAM assessment, shows a strongly divergent pattern in recruitment and also some differences in the trend of SSB. Mean fishing mortality is somewhat more variable in the VPA reconstruction compared to the SAM assessment. 

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "om_assessments", level = 1, display = FALSE,
  caption = "Comparison of different assessments. VPA-M is used going forward")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_comparing_assessments.jpg")))

```

_`r fig_nums("om_VPADDM")`_

\newpage

**Density dependence in mass-at-age**

We then explored the impacts of density dependence in mass at age on the equilibrium values of total biomass and yield. In the plot below, there are multiple lines for mass at age (one line for each value of F). Maturity and M are fixed values by age. The equilibrium curves are on the bottom right: the red line is the equilibrium curve for mass at age, while the black line is with age-varying M but without density dependence. 

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "om_VPADDM", level = 1, display = FALSE,
  caption = "Simulation of density dependence in Mass-at-age")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_VPADDM_4panels.jpg")))

```

_`r fig_nums("om_VPADDM")`_

\newpage

**Density dependence in mass-at-age and maturity at age**

Next, we explored the impacts of density dependence in mass at age and maturity at age on the equilibrium values of total biomass and yield. In the plot below, there are multiple lines for mass at age and maturity at age (one line for each value of F). Natural mortality are fixed values by age. The equilibrium curves are on the bottom right: the red line is the equilibrium curve for mass at age and maturity at age, while the black line is with age-varying M but without density dependence 

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "om_VPADDMM", level = 1, display = FALSE,
  caption = "Simulation of density dependence in Mass-at-age and Maturity at age")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_VPADDMM_4panels.jpg")))

```

_`r fig_nums("om_VPADDMM")`_

\newpage

**Density dependence in mass-at-age, maturity at age and M at age**

Finslly, we explored the impacts of density dependence in mass at age and maturity at age and Natural mortality at age on the equilibrium values of total biomass and yield. In the plot below, there are multiple lines for mass at age, maturity at age and natural mortality at age (one line for each value of F). The equilibrium curves are on the bottom right: the red line is the equilibrium curve for mass at age and maturity at age and natural mortality at age, while the black line is with age-varying M but without density dependence. 

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}
fig_nums(
  name    = "om_VPADDMMM", level = 1, display = FALSE,
  caption = "Simulation of density dependence in Mass-at-age, maturity at age and M at age")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_VPADDMMM_4panels.jpg")))

```

_`r fig_nums("om_VPADDMMM")`_

\newpage

**Comparison of equilibrium curves for density dependence analyses: biomass against yield**

Introducing density-dependent process has an impact on the estimate Bmsy (calculated from Total biomass) which is shifted to the left. The expected impact on the equilibrium yield is relatively small. 

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}
fig_nums(
  name    = "om_eqyield", level = 1, display = FALSE,
  caption = "Equilibrium curves for density dependence analyses: biomass against yield")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_comparing_dd.jpg")))
```

_`r fig_nums("om_eqyield")`_

\newpage

```{r, echo=FALSE, fig.width=0.6, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

fig_nums(
  name    = "om_eqF", level = 1, display = FALSE,
  caption = "Equilibrium curves for density dependence analyses: biomass against F")

knitr::include_graphics(path=file.path(figuresdir, paste0(mystk,"_comparing_dd_F.jpg")))

```

_`r fig_nums("om_eqF")`_

\newpage

**Overview of MSY values from different scenarios**

```{r, echo=FALSE, fig.width=10, fig.asp=0.6, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}

tab_nums(
  name    = "msy", level = 1, display = FALSE,
  caption = paste0(mystkname, ". MSY values from different scenarios"))

cat(readLines(file.path(tablesdir, paste(mystk, "msy.txt", sep="_"))), sep = '\n')

```

_`r tab_nums("dd_pars")`_




<!-- =============================================================================================================== -->
<!-- Section 5: Running forward projections                                                                          -->
<!-- =============================================================================================================== -->

# Forward projections without feedback

```{r, echo=FALSE, fig.asp=1.0, fig.align="center", message=FALSE, warning=FALSE, cache=FALSE}


```


<!-- =============================================================================================================== -->
<!-- Section 6: Discussion and conclusions                                                                           -->
<!-- =============================================================================================================== -->

# Discussion and conclusions

The quality shall live up to that demanded by the International Council for the Exploration of the Sea (ICES) and potentially be used in ICES advice to fisheries managers. The Consultant shall be interacting with the leadership of the project Henrik Sparholt, or his representative, in the process of developing the software. The software shall be made publicly available via Github or on alternative platform if so directed by Henrik Sparholt or his representative.

<!-- =============================================================================================================== -->
<!-- Funding                                                                                                         -->
<!-- =============================================================================================================== -->

# Funding




<!-- =============================================================================================================== -->
<!-- References                                                                                                      -->
<!-- =============================================================================================================== -->

# References

Hamre, J. 1980. Biology, exploitation and management of the NorthEast Atlantic mackerel. Rapp P-V Reun (CIEM), 177, 212-242.

ICES (2019). Interbenchmark workshop on the Assessment of northeast atlantic Mackerel (IBPNEAMAC), 4-7 March 2019. ICES Volume  1, Issue 5: 71 pp.

ICES (2022). Working Group on Widely Distributed Stocks (WGWIDE 2022) Volume 4, Issue 73.

Lorenzen, K. (1997). "The relationship between body weight and natural mortality in juvenile and adult fish: a comparison of natural ecosystems and aquaculture." Oceanographic Literature Review 4(44): 339.

Nielsen, A. and C. W. Berg (2014). "Estimation of time-varying selectivity in stock assessments using state-space models." Fisheries Research 158(0): 96-101.


<!-- =============================================================================================================== -->
<!-- Annex 1: OM conditioning                                                                           -->
<!-- =============================================================================================================== -->

# Annex 1: OM conditioning



<!-- =============================================================================================================== -->
<!-- Annex 2: Density dependent processes                                                                           -->
<!-- =============================================================================================================== -->

# Annex 2: Density dependent processes



